#!/bin/sh
export POSIXLY_CORRECT=yes
export LC_NUMERIC=en.US.UTF-8
help_print()
{
    echo ""
    echo "tradelog [-h|--help] [FILTR] [PŘÍKAZ] [LOG [LOG2 [...]]"
    echo "-h|--help   vypsani napovedy"
    echo "tradelog [-h|--help] [FILTR] [PŘÍKAZ] [LOG [LOG2 [...]]"
    echo "[FILTR]"

    echo "[PŘÍKAZ]"

}
FILTR=""
FILTRCOUNTER=0
POCETSOUBORU=0
COUNTERSOUBORU=0
PRIKAZ=""
FILES=""
GZ_FILES="" 
while [ "$#" -gt 0 ] 
do
    case "$1" in
        -h|--help)
            help_print
            exit 0
            ;;
        list-tick)
            PRIKAZ="list-tick"
            shift
            ;;
        -w)
            WIDTH="$2"
            shift
            shift
            ;;
        profit)
            PRIKAZ="profit"
            shift
            ;;
        
        -t)
            FILTR="$FILTR ticker $2"
            FILTRCOUNTER=$(echo "$FILTRCOUNTER+1" | bc)
            shift
            shift
            ;;
        pos)
            PRIKAZ="pos"
            shift
            ;;
        *)
            case "$1" in 
                *.gz*)
                    GZ_FILES="$1 $GZ_FILES"
                     ;;
                *)
                    
                    FILES="$1" #pridat vic files
                    POCETSOUBORU=$(echo "$POCETSOUBORU+1" | bc)
            esac    
            shift
            ;;
    esac
done
NACTENYTEXT=""
if [ "$FILES" = "" ]; then  #pokud je neni zadany soubor cti z toho co ti zada
    while read -r line
    do 
    echo "$line"
    done < "${1:-/dev/stdin}"   
    exit 1 
fi


# while [ "$POCETSOUBORU" != "$COUNTERSOUBORU" ] 
# do
# LIST TICK VYPIS
TICKERS="" 
if [ "$PRIKAZ" = "list-tick" ] 
then
    while IFS= read -r line; do
        NEWTICKER=$(echo "$line" | cut -d ";" -f 2)
        TICKERS="$NEWTICKER\n$TICKERS"
    done < "$FILES"
    echo "$TICKERS" | sort -u 
fi







# COUNTERSOUBORU=$(echo "$COUNTERSOUBORU+1" | bc)
# echo $POCETSOUBORU
# echo $COUNTERSOUBORU





#PROFIT VYPIS
SUMABUY=0
SUMASELL=0
if [ "$PRIKAZ" = "profit" ] 
then
    while IFS= read -r line; do

    case "$line" in 
            *sell*)
                HODNOTASELL=$(echo "$line" | cut -d ";" -f 4)
                POCETAKCII=$(echo "$line" | cut -d ";" -f 6)
                SUMASELL=$(echo "$SUMASELL+($HODNOTASELL*$POCETAKCII)" | bc)
                ;;
            *buy*)  
                HODNOTABUY=$(echo "$line" | cut -d ";" -f 4)
                POCETAKCII=$(echo "$line" | cut -d ";" -f 6)
                SUMABUY=$(echo "$SUMABUY+($HODNOTABUY*$POCETAKCII)" | bc)
                ;;         
    esac
    done < "$FILES"
    echo "$SUMASELL-$SUMABUY" | bc
fi
#POSITION VYPIS
if [ "$PRIKAZ" = "pos" ] 
then
    while IFS= read -r line; do
        NEWTICKER=$(echo "$line" | cut -d ";" -f 2)

        POCETZNAKU=${#NEWTICKER} 
        while [ "$POCETZNAKU" != "11" ] 
        do
          NEWTICKER="$NEWTICKER "
          POCETZNAKU=$(echo "$POCETZNAKU+1" | bc)  
        done
        NEWTICKER="$NEWTICKER:\n$TICKERS"
        TICKERS="$NEWTICKER:\n$TICKERS"
    done < "$FILES"
    echo "$TICKERS" 
fi



# done
echo "PRIKAZ $PRIKAZ"
echo "SOUBORY $FILES"
echo "GZ SOUBORY $GZ_FILES"
echo "FILTER $FILTR $FILTRCOUNTER"

